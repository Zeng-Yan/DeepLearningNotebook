## 卷积






```python

f1 = torch.tensor([[0, -1, 0],
                   [-1, 4, -1],
                   [0, -1, 0]]).float().reshape(1,1,3,3)

f2 = torch.tensor([[-1, -1, -1],
                   [0, 0, 0],
                   [-1, -1, -1]]).float().reshape(1,1,3,3)

f3 = torch.tensor([[1, 1, 1],
                   [1, 1, 1],
                   [1, 1, 1]]).float().reshape(1,1,3,3)

f4 = torch.tensor([[-1, -1, -1],
                   [-1, 8, -1],
                   [-1, -1, -1]]).float().reshape(1,1,3,3)
```







```python
import matplotlib.pyplot as plt
import torch
import torch.nn as nn

p = 'D:/b.jpg'  # 图片路径
im = plt.imread(p)  # 读取
im = im[:, :, 1]  # 灰度矩阵

plt.imshow(im, cmap='gray')  # 显示
plt.show()

s1, s2 = im.shape  # 图像的长宽
im = torch.from_numpy(im).reshape(1, 1, s1, s2).float()  # 把图像矩阵转为tensor

conv_layer = nn.Conv2d(in_channels=1, out_channels=1,
                       stride=1, kernel_size=3, padding=2)  # 初始化一个卷积层
print(conv_layer.weight)  # 打印卷积层的权值

# 自定义卷积核
kernel = torch.tensor([[2, 0, 0],
                       [0, -1, 0],
                       [0, 0, -1]]).float().reshape(1, 1, 3, 3)

conv_layer.weight.data = kernel  # 将先前定义的卷积层里卷积核的权值设置为f1
print(conv_layer.weight)  # 打印卷积层的权值

im = conv_layer(im)  # 对图像进行卷积操作
im = im.squeeze().detach().cpu().numpy()  # 转为array

plt.imshow(im, cmap='gray')  # 显示
plt.show()
```









